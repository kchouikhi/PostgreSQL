SELECT vlan.name as vLAN_Name, n.name as Node_Name, ip.name as IP_Address, phys_comp.serial as chassis, s.active_addr, get_byte(active_addr,octet_length(active_addr)-4)||'.'||get_byte(active_addr,octet_length(active_addr)-3)||'.'||get_byte(active_addr,octet_length(active_addr)-2)||'.'||get_byte(active_addr,octet_length(active_addr)-1) as mgmt_ip
FROM nms_node n, nms_snmp_agent a, nms_snmp_agent_settings s ,public.nms_ip_addr as ip, public.nms_ip_subnet as vlan, public.nms_phys_comp as phys_comp
WHERE n.snmp_agent = a.id
AND a.id = s.id
AND ip.hosted_on = n.id
AND vlan.id = ip.ip_subnet
ORDER BY mgmt_ip Desc






SELECT 
    vlan.name AS vlan_name, 
    STRING_AGG(
        get_byte(ip.active_addr, octet_length(ip.active_addr)-4)::text || '.' || 
        get_byte(ip.active_addr, octet_length(ip.active_addr)-3)::text || '.' || 
        get_byte(ip.active_addr, octet_length(ip.active_addr)-2)::text || '.' || 
        get_byte(ip.active_addr, octet_length(ip.active_addr)-1)::text, 
        ', '
    ) AS ip_addresses,
    COUNT(ip.name) AS ip_count
FROM 
    nms_node n
    JOIN nms_snmp_agent a ON n.snmp_agent = a.id
    JOIN nms_snmp_agent_settings s ON a.id = s.id
    JOIN public.nms_ip_addr ip ON ip.hosted_on = n.id
    JOIN public.nms_ip_subnet vlan ON vlan.id = ip.ip_subnet
    JOIN public.nms_phys_comp phys_comp ON phys_comp.serial = n.serial
GROUP BY 
    vlan.name
ORDER BY 
    vlan.name;





Voici une version corrigée et améliorée de votre email :


---

Objet : Fichier Excel consolidé

Bonjour,

Veuillez trouver en pièce jointe un fichier Excel consolidé regroupant les précédents fichiers.

La première feuille ("CMDB_LIST") est dédiée aux données d’entrée.

Les autres feuilles sont structurées selon les critères établis : IP Address et Châssis.


Détails des feuilles :

1. Châssis/Serial (feuille "Chassis") :
Cette feuille présente les données suivantes :



SELECT n.name AS node_name,  
       n.long_name AS hostname,  
       phy.serial AS chassis,  
       n.system_desc AS commentaire  
FROM nms_node n,  
     nms_phys_comp phy  
WHERE n.id = phy.man_by  
AND n.reg_created > '2024-11-27 17:00:00';

2. IP Address (feuille "IP Addr") :
Cette feuille contient les informations suivantes :



SELECT vlan.name AS VLAN,  
       ip.name AS IP_PER_VLAN,  
       n.long_name AS hostname,  
       n.last_discovered AS discovered  
FROM nms_ip_addr ip,  
     nms_node n,  
     nms_ip_subnet vlan  
WHERE n.id = ip.hosted_on  
AND ip.ip_subnet = vlan.id  
AND ip.reg_created > '2024-11-27 17:00:00';

Je reste disponible pour toute information complémentaire.

Cordialement,
[Votre prénom et nom]


---

Cette version est plus lisible, professionnelle, et exempte de redondances.



