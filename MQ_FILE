SELECT vlan.name as vLAN_Name, n.name as Node_Name, ip.name as IP_Address, phys_comp.serial as chassis, s.active_addr, get_byte(active_addr,octet_length(active_addr)-4)||'.'||get_byte(active_addr,octet_length(active_addr)-3)||'.'||get_byte(active_addr,octet_length(active_addr)-2)||'.'||get_byte(active_addr,octet_length(active_addr)-1) as mgmt_ip
FROM nms_node n, nms_snmp_agent a, nms_snmp_agent_settings s ,public.nms_ip_addr as ip, public.nms_ip_subnet as vlan, public.nms_phys_comp as phys_comp
WHERE n.snmp_agent = a.id
AND a.id = s.id
AND ip.hosted_on = n.id
AND vlan.id = ip.ip_subnet
ORDER BY mgmt_ip Desc






SELECT 
    vlan.name AS vlan_name, 
    STRING_AGG(
        get_byte(ip.active_addr, octet_length(ip.active_addr)-4)::text || '.' || 
        get_byte(ip.active_addr, octet_length(ip.active_addr)-3)::text || '.' || 
        get_byte(ip.active_addr, octet_length(ip.active_addr)-2)::text || '.' || 
        get_byte(ip.active_addr, octet_length(ip.active_addr)-1)::text, 
        ', '
    ) AS ip_addresses,
    COUNT(ip.name) AS ip_count
FROM 
    nms_node n
    JOIN nms_snmp_agent a ON n.snmp_agent = a.id
    JOIN nms_snmp_agent_settings s ON a.id = s.id
    JOIN public.nms_ip_addr ip ON ip.hosted_on = n.id
    JOIN public.nms_ip_subnet vlan ON vlan.id = ip.ip_subnet
    JOIN public.nms_phys_comp phys_comp ON phys_comp.serial = n.serial
GROUP BY 
    vlan.name
ORDER BY 
    vlan.name;
